<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Attendance Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Arial, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    header {
      background: #fff;
      box-shadow: 0 4px 15px rgba(0,0,0,.1);
      padding: 0;
      border-radius: 12px 12px 0 0;
      margin-bottom: 0;
    }
    .apptitle {
      display: flex; 
      align-items: center; 
      padding: 20px 30px;
      background: linear-gradient(135deg, #16883d 0%, #0d5a2e 100%);
      border-radius: 12px 12px 0 0;
    }
    .apptitle svg { height: 45px; margin-right: 20px;}
    .apptitle h1 {
      font-family: 'Arial Black', Arial; 
      font-size: 2.5rem; 
      margin:0; 
      color: #fff;
      letter-spacing: 2px; 
      font-weight: 700;
    }
    .apptitle span {
      font-size: 2.5rem; 
      color: #ffd600; 
      font-weight: 700; 
      letter-spacing: 2px;
    }
    nav {
      display: flex; 
      background: #16883d; 
      color:#fff; 
      font-size: 1.1rem;
      padding: 0 30px; 
      gap: 10px;
      border-top: 2px solid #ededed;
    }
    nav button {
      background: none; 
      border: none; 
      color: #fff; 
      font-weight: 600;
      padding: 15px 25px; 
      cursor: pointer;
      transition: all .3s;
      border-bottom: 3px solid transparent;
    }
    nav button:hover { 
      background: rgba(255,255,255,.1);
      border-bottom-color: #ffd600;
    }
    nav button.active { 
      background: rgba(0,0,0,.2);
      border-bottom-color: #ffd600;
    }
    .container {
      max-width: 1200px; 
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,.15);
      overflow: hidden;
    }
    .main-content { 
      padding: 40px;
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 40px;
    }
    @media (max-width: 1000px) {
      .main-content { 
        grid-template-columns: 1fr;
        padding: 30px;
      }
    }
    .card {
      background: #f8f9ff; 
      border-radius: 14px; 
      padding: 35px;
      border: 2px solid #e8f0f7;
      min-height: 400px;
    }
    .card h2 { 
      font-size: 1.8rem; 
      margin-bottom: 8px; 
      color: #16883d;
      font-weight: 700;
    }
    .desc-text { 
      color: #666; 
      font-size: 0.95rem; 
      margin-bottom: 20px;
      line-height: 1.5;
    }
    .avatar { 
      text-align: center; 
      margin-bottom: 20px;
    }
    .avatar img {
      height: 70px; 
      border-radius: 50%;
      border: 3px solid #16883d;
      background-color: #e6f1e8;
    }
    label { 
      display: block; 
      color: #333; 
      font-weight: 600; 
      margin-top: 15px;
      font-size: 0.95rem;
    }
    input[type="text"], 
    input[type="password"], 
    input[type="date"],
    select {
      margin-top: 8px; 
      padding: 12px 15px; 
      width: 100%; 
      border-radius: 8px; 
      border: 2px solid #ddd;
      font-size: 1rem; 
      margin-bottom: 15px; 
      background: #fff;
      transition: all .3s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #16883d;
      box-shadow: 0 0 0 3px rgba(22, 136, 61, 0.1);
    }
    button, .btn {
      background: linear-gradient(135deg, #16883d 0%, #0d5a2e 100%);
      color: #fff; 
      border: none; 
      padding: 12px 25px; 
      border-radius: 8px; 
      font-size: 1rem; 
      font-weight: 700; 
      cursor: pointer; 
      margin-top: 10px; 
      margin-right: 10px;
      transition: all .3s;
      box-shadow: 0 4px 12px rgba(22, 136, 61, 0.3);
    }
    button:hover, .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(22, 136, 61, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    .error { 
      color: #d32f2f; 
      font-size: 0.9rem; 
      margin: 12px 0;
      padding: 10px;
      background: #ffebee;
      border-radius: 6px;
    }
    .success { 
      color: #16883d; 
      font-size: 0.9rem;
      margin: 12px 0;
      padding: 10px;
      background: #e8f5e9;
      border-radius: 6px;
    }
    .attendance-table { 
      width: 100%; 
      margin-top: 20px; 
      border-collapse: collapse;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
      border-radius: 8px;
      overflow: hidden;
    }
    .attendance-table th { 
      background: linear-gradient(135deg, #ffe59b 0%, #ffd600 100%);
      font-size: 1rem;
      font-weight: 700;
      color: #333;
    }
    .attendance-table td, .attendance-table th { 
      padding: 15px; 
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
    }
    .attendance-table tr:hover {
      background: #f5f5f5;
    }
    .attendance-table tr:last-child td {
      border-bottom: none;
    }
    .section-buttons { 
      margin: 20px 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
    }
    .section-buttons button {
      padding: 12px 15px; 
      border-radius: 8px; 
      border: 2px solid #ddd;
      cursor: pointer; 
      background: #fff;
      color: #16883d; 
      font-weight: 700; 
      font-size: 1rem;
      transition: all .3s;
      margin: 0;
    }
    .section-buttons button:hover { 
      background: #ffd600; 
      color: #09522b;
      border-color: #ffd600;
    }
    .section-buttons button.active { 
      background: #ffd600; 
      color: #09522b;
      border-color: #ffd600;
      box-shadow: 0 4px 12px rgba(255, 214, 0, 0.3);
    }
    .actions-row { 
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .actions-row .btn { 
      margin: 0;
      width: 100%;
      text-align: center;
    }
    .attendance-btn-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .attendance-btn-group button {
      margin: 0;
      padding: 8px 12px;
      font-size: 0.9rem;
      flex: 1;
      min-width: 100px;
    }
    .present-btn { 
      background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }
    .present-btn:hover { box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4); }
    
    .absent-btn { 
      background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
      box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
    }
    .absent-btn:hover { box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4); }
    
    .permission-btn { 
      background: linear-gradient(135deg, #ff9800 0%, #e65100 100%);
      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
    }
    .permission-btn:hover { box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4); }
    
    .hidden { display: none !important; }
    .forgot-link {
      color: #16883d;
      font-weight: 600;
      text-decoration: none;
      font-size: 0.95rem;
      cursor: pointer;
      margin-top: 10px;
      display: inline-block;
    }
    .forgot-link:hover {
      text-decoration: underline;
    }
    .check-row {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      margin: 15px 0;
    }
    .check-row input {
      margin: 0;
    }
    .check-row button {
      margin: 0;
      height: fit-content;
      padding: 12px 20px;
    }
    #checkResult {
      display: block;
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      font-weight: 600;
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <div class="apptitle">
      <svg viewBox="0 0 58 58" fill="none" height="45">
        <circle cx="29" cy="29" r="29" fill="#16883d"/>
        <rect x="19" y="34" width="20" height="8" rx="4" fill="#ffd600"/>
        <rect x="15" y="14" width="28" height="16" rx="5.5" fill="#fff"/>
        <rect x="21" y="20" width="16" height="3" rx="1.5" fill="#16883d"/>
        <rect x="21" y="25" width="10" height="2" rx="1" fill="#16883d"/>
      </svg>
      <h1><span>A</span>ttendance <span>P</span>ortal</h1>
    </div>
    <nav>
      <button onclick="showView('adminLogin')" id="navAdminLogin" class="active">üìã Admin Panel</button>
      <button onclick="showView('studentLogin')" id="navStudentLogin">üë§ Student Check</button>
    </nav>
  </header>

  <div class="main-content">

    <!-- ADMIN LOGIN -->
    <div id="adminLogin" class="card">
      <div class="avatar">
        <svg viewBox="0 0 100 100" fill="none" width="70">
          <circle cx="50" cy="30" r="20" fill="#16883d"/>
          <path d="M10 100 Q10 60 50 60 Q90 60 90 100" fill="#16883d"/>
        </svg>
      </div>
      <h2>Admin Login</h2>
      <div id="logmsg"></div>
      <label for="username">Username</label>
      <input type="text" id="username" placeholder="DEPTCSE" autocomplete="username" />
      <label for="password">Password</label>
      <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
      <button onclick="login()">üîì Login</button>
      <a class="forgot-link" onclick="forgotpw();return false;">Forgot Password?</a>
    </div>

    <!-- ATTENDANCE MANAGEMENT -->
    <div id="attendance" class="card hidden">
      <h2>üìä Attendance Management</h2>
      <p class="desc-text">Mark & save attendance for any date and section</p>
      <div id="savemsg"></div>
      
      <label for="dateInput">üìÖ Date</label>
      <input type="date" id="dateInput" />

      <div class="actions-row">
        <button onclick="saveAllAttendance()" class="btn">üíæ Save All Sections</button>
        <button onclick="downloadAbsentees()" class="btn">üì• Download Absentees</button>
        <button onclick="downloadWeekly()" class="btn">üìä Weekly Report</button>
      </div>

      <label style="margin-top: 20px;"><b>üîç Check Any Student</b></label>
      <div class="check-row">
        <input type="text" id="checkRegInput" placeholder="Reg. Number" />
        <input type="date" id="checkDateInput" />
        <button onclick="checkStatus()" class="btn">Check</button>
      </div>
      <span id="checkResult"></span>

      <label style="margin-top: 20px;"><b>üìç Select Section</b></label>
      <div class="section-buttons">
        <button onclick="showSection('A')" id="secBtnA" class="active">Section A</button>
        <button onclick="showSection('B')" id="secBtnB">Section B</button>
        <button onclick="showSection('C')" id="secBtnC">Section C</button>
        <button onclick="showSection('D')" id="secBtnD">Section D</button>
      </div>

      <table class="attendance-table">
        <thead>
          <tr>
            <th>Reg Number</th>
            <th>Name</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="attBody"></tbody>
      </table>
      <button onclick="logoutAdmin()" class="btn" style="background: linear-gradient(135deg, #f44336 0%, #c62828 100%); margin-top: 20px;">üö™ Logout</button>
    </div>

    <!-- STUDENT LOGIN -->
    <div id="studentLogin" class="card hidden">
      <h2>üë§ Check Your Attendance</h2>
      <p class="desc-text">Enter your registration number to view attendance</p>
      <div id="stuLoginMsg"></div>
      
      <label for="stuUsername">Registration Number</label>
      <input type="text" id="stuUsername" placeholder="e.g. 23KD1A0501" />
      
      <label for="stuDate">Date</label>
      <input type="date" id="stuDate" />
      
      <button onclick="checkStudentAttendance()">‚úì Check Attendance</button>
      
      <div id="stuAttendanceResult" style="margin-top: 20px; font-weight: bold;"></div>
      
      <button onclick="logoutStudent()" class="btn" style="background: linear-gradient(135deg, #f44336 0%, #c62828 100%); margin-top: 20px;">üö™ Logout</button>
    </div>

  </div>
</div>

<script>
const sectionStudents = {
  A: [
    ['23KD1A0501', 'ABDUL GUFFRAN'],['23KD1A0502', 'ADAPAKA TEJASRI'],['23KD1A0503', 'ADDANKI MAHESWARI'],['23KD1A0504', 'ALAMANDA SANJANA BLESSY'],
    ['23KD1A0505', 'ALAVELLI SRIPRIYA'],['23KD1A0506', 'AAMUDALA RAJESH'],['23KD1A0507', 'APPANA PRANEETH KUMAR'],['23KD1A0508', 'BADIGANTI MANOJ'],
    ['23KD1A0509', 'BAGGAM BHAVANASRI'],['23KD1A0510', 'BALIVADA MRUDULA'],['23KD1A0511', 'BANGARU VANDHANA'],['23KD1A0512', 'BANKI SAI MONISH'],
    ['23KD1A0513', 'BATTULA SAI KUMAR'],['23KD1A0514', 'BAYYA AKHIL'],['23KD1A0515', 'BEVARA DEVI PRASAD'],['23KD1A0516', 'BHASKARA AKSHAYA KUNDANIKA'],
    ['23KD1A0517', 'BHOGAPURAPU SAI MEGHANA'],['23KD1A0518', 'BITRA GIRIDDHAR'],['23KD1A0519', 'BODASINGI SIRISHA'],['23KD1A0520', 'BODDETI VYSHNAVI'],
    ['23KD1A0521', 'BODDU APPALA RAJU'],['23KD1A0522', 'BOGADI NAGAMANI'],['23KD1A0523', 'BONTHU SRUTHI'],['23KD1A0524', 'BURADA MEGHANA'],
    ['23KD1A0525', 'CHALICHAMA LOKESH SEETHARAM'],['23KD1A0526', 'CHANDAKA BHARATH KUMAR'],['23KD1A0527', 'CHANDAKA PAVITHRA'],['23KD1A0528', 'CHAPPA BHUVANA SAI'],
    ['23KD1A0529', 'CHILAKALAPUDI SRIVALLI'],['23KD1A0530', 'CHINTALAPATI LAKSHMI'],['23KD1A0531', 'CHITROTHU RAHUL KRISHNA'],['23KD1A0532', 'CHOKKAPU MOHAN SATHVIK'],
    ['23KD1A0533', 'CHUKKA JNANACHARAN'],['23KD1A0534', 'CHUKKA SAI KIRAN'],['23KD1A0535', 'DACHEPALLI MADHUMITHA'],['23KD1A0537', 'DANDU UDAY KIRAN'],
    ['23KD1A0538', 'DASARI LOVA RAJU'],['23KD1A0539', 'DASARI MOHAN'],['23KD1A0540', 'DASARI SURESH'],['23KD1A0541', 'DATLA SEETHARAMARAJU'],
    ['23KD1A0542', 'DATTI ANU'],['23KD1A0543', 'DEEPATI MOHITH'],['23KD1A0544', 'DEVU VENKATAVIVEK'],['23KD1A0545', 'DOKARA SURESH'],
    ['23KD1A0546', 'DORA KARTHIK'],['23KD1A0547', 'DUMPALA SANYASIRAO'],['23KD1A0548', 'DUVVU TEJESWAR'],['23KD1A0549', 'ELURU BHANUSHANKAR'],
    ['23KD1A0550', 'ESSARAPU AVINASH'],['23KD1A0551', 'ETTLA MARY AKSHITHA'],['23KD1A0552', 'FARHEEN MUNAVVAR FATHIMA'],['23KD1A0553', 'GADABANTI GANESH'],
    ['23KD1A0554', 'GANDATE ROHIT KUMAR'],['23KD1A0555', 'GANDHULI MONIKA'],['23KD1A0556', 'GANDRETI GEETHA SRI'],['23KD1A0557', 'GANDUBARIKI PRAGNA'],
    ['23KD1A0558', 'GARE TEJASWINI'],['23KD1A0559', 'GARI VENKATAMANIKANTA'],['23KD1A0560', 'GEDALA CHARMILA DEVI SRI'],['23KD1A0561', 'GEDALA DIVYA'],
    ['23KD1A0562', 'GEDELA SATEESH'],['23KD1A0563', 'GOLLU ADITYA'],['23KD1A0564', 'GOLLU PAVAN KUMAR'],['23KD1A0565', 'GORLE HARITHA'],
    ['23KD1A0566', 'GOTTAPU LAKSHMI CHARAN'],['22KD1A0575', 'KANDUKURI ABHILASH'],['24KD5A0501', 'BANDARU SREERAM'],['24KD5A0502', 'BAVISETTI MANOJ KUMAR'],
    ['24KD5A0503', 'BENDI BHAVANI'],['24KD5A0504', 'BONDA SURESH'],['24KD5A0505', 'GOLAJANI JHANSI'],['20KD1A05G5', 'SIMMITI KARUNA BABU']
  ],
  B: [
    ['23KD1A0567', 'GRANDHI MANASA'],['23KD1A0568', 'GUDDALA JAHNAVI'],['23KD1A0569', 'GUDEPU YASWANTH'],['23KD1A0570', 'GUDLA BHARATHI RATHNA KUMARI'],
    ['23KD1A0571', 'GULAMAJJI BHARGAV'],['23KD1A0572', 'GUNANA SAILAJA'],['23KD1A0573', 'GUNDU PRIYANKA'],['23KD1A0574', 'GUNTUKU ABHISHEK SAI'],
    ['23KD1A0575', 'GURRALA NAGA VARSHITHA'],['23KD1A0576', 'GURUGU VINAY KUMAR'],['23KD1A0577', 'HARIDASULA HARSHA VARDHAN'],['23KD1A0578', 'IMANDI HARISH'],
    ['23KD1A0579', 'IMANDI MYTHRI'],['23KD1A0580', 'IMMIDISETTI SNEHITHA'],['23KD1A0581', 'JAMI INDUMATHI'],['23KD1A0582', 'JAMPA HARSHITHA'],
    ['23KD1A0583', 'JAMPARANGI DINESH KUMAR'],['23KD1A0584', 'JARAJAPU DURGA PRASAD'],['23KD1A0585', 'JARJAPU PRASANTH'],['23KD1A0586', 'JUTTADA SWETHA'],
    ['23KD1A0587', 'JYOTHSNA ARDHAHAKULA'],['23KD1A0588', 'KAKARLAPUDI NARASIMHA ANIRUDH VARMA'],['23KD1A0589', 'KALISETTI DEEPAK'],['23KD1A0590', 'KALISETTI HARINI'],
    ['23KD1A0591', 'KALIVARAPU NAMRATHA'],['23KD1A0592', 'KALLA VENKATA HIRAN MAAVI'],['23KD1A0593', 'KALYAMPUDI RAVI KIRAN'],['23KD1A0594', 'KALYANAM GOWTHAMI'],
    ['23KD1A0596', 'KANCHUPARTHI JYOTHSNA'],['23KD1A0597', 'KANDI ASHISH'],['23KD1A0598', 'KANURI PUJITHA'],['23KD1A0599', 'KARRI DIVYA RANI'],
    ['23KD1A05A0', 'KARRI RAKSHITHA'],['23KD1A05A1', 'KARRI SATYA GOWTHAM KUMAR REDDY'],['23KD1A05A2', 'KASIREDDY JYOTHI SHIVANANDH'],['23KD1A05A3', 'KATTAMURI PRAVALLIKA'],
    ['23KD1A05A4', 'KATTOJU ABILESH'],['23KD1A05A5', 'KELLA MITHIN KUMAR'],['23KD1A05A6', 'KILLO CHINNI PRAKASH'],['23KD1A05A8', 'KOLA ABHISHEK'],
    ['23KD1A05A9', 'KOLA VARSHINI'],['23KD1A05B0', 'KOLAGANA POORNA CHANDRA RAO'],['23KD1A05B1', 'KOLLA SRAVANI'],['23KD1A05B2', 'KOLUSU ABHINAYA ANJALI'],
    ['23KD1A05B3', 'KONADA RASHMITHA'],['23KD1A05B4', 'KONDAKA SOWMYA'],['23KD1A05B5', 'KONDAPU RAMI REDDY'],['23KD1A05B6', 'KORADA JAGADEESH'],
    ['23KD1A05B7', 'KORADA NAGA DEVI'],['23KD1A05B8', 'KOSARA AKASH'],['23KD1A05B9', 'KOSIREDDY SAI KUMAR'],['23KD1A05C0', 'KOTTAKOTA KAVERI'],
    ['23KD1A05C1', 'KOTYADA BHARGAVI'],['23KD1A05C2', 'KOTYADA MAHESH'],['23KD1A05C3', 'KOVVURI CHARAN KUMAR REDDY'],['23KD1A05C5', 'KOVVURU KIRANSAI'],
    ['23KD1A05C6', 'KURIMINELLI POOJITHA'],['23KD1A05C7', 'LENKA BHARGAVI'],['23KD1A05C8', 'LODAGALA THARUN'],['23KD1A05C9', 'MADHABATHULA MANOJ KUMAR'],
    ['23KD1A05D0', 'MAJJI BHANUSRI'],['23KD1A05D1', 'MAMIDI MARUTHI PRASAD'],['23KD1A05D2', 'NAGIREDLA SRAVANI'],['24KD5A0506', 'GOLLU DURGAPRASAD'],
    ['24KD5A0507', 'GUNDU BALU'],['24KD5A0508', 'JAJIMOGGALA SRAVANTHI'],['24KD5A0509', 'KOTNANA LAHARI'],['24KD5A0510', 'MADDI KUMAR'],
    ['24KD5A0511', 'MANDALA MAHESH NAIDU']
  ],
  C: [
    ['23KD1A05D3', 'M BHARGAVI'],['23KD1A05D4', 'M PRAVALLIKA'],['23KD1A05D5', 'M VARAPRASAD'],['23KD1A05D6', 'M MEGHANA'],
    ['23KD1A05D7', 'M SWETHA'],['23KD1A05D8', 'M ABHINAV'],['23KD1A05D9', 'M NAVYATHA'],['23KD1A05E0', 'M SINDHUJA'],
    ['23KD1A05E1', 'M PRANATHI'],['23KD1A05E2', 'M HARSHITHA'],['23KD1A05E3', 'M SHARMILA'],['23KD1A05E4', 'M SHAILAJA'],
    ['23KD1A05E5', 'MOHSIN ALI'],['23KD1A05E6', 'M FARHEEN BEGUM'],['23KD1A05E7', 'M VAMSI KRISHNA'],['23KD1A05E8', 'M MADHURI'],
    ['23KD1A05E9', 'M SARAYU SRI'],['23KD1A05F0', 'M YUVA KIRAN'],['23KD1A05F1', 'M JYOTHSNA'],['23KD1A05F2', 'M BENSON'],
    ['23KD1A05F3', 'M BHARAT'],['23KD1A05F4', 'M MANOJ KUMAR'],['23KD1A05F5', 'N DEVI'],['23KD1A05F6', 'N ADHARSH'],
    ['23KD1A05F7', 'N SUBHASH'],['23KD1A05F9', 'N PRAVEEN KUMAR'],['23KD1A05G0', 'N KYATHI'],['23KD1A05G1', 'N PRANATHI'],
    ['23KD1A05G2', 'N HARI CHARAN'],['23KD1A05G3', 'NANADHINI M'],['23KD1A05G4', 'N CHANIKYA'],['23KD1A05G5', 'N MEGHANA'],
    ['23KD1A05G6', 'N SAITEJA'],['23KD1A05G7', 'N DRAKSHAMANI'],['23KD1A05G8', 'N LAVANYA'],['23KD1A05G9', 'N AISHWARYA'],
    ['23KD1A05H0', 'N GEETHA'],['23KD1A05H1', 'P CHIDVILAS'],['23KD1A05H2', 'P KIRAN'],['23KD1A05H3', 'P HARISHANKAR'],
    ['23KD1A05H4', 'P SAIKIRAN'],['23KD1A05H5', 'PVS POORNANANDA'],['23KD1A05H7', 'P GEETHASRI'],['23KD1A05H8', 'P KAVITHA'],
    ['23KD1A05I0', 'P VINEELA'],['23KD1A05I1', 'P SUMANTH'],['23KD1A05I2', 'P GEETHANJALI'],['23KD1A05I3', 'P DEEPIKA'],
    ['23KD1A05I4', 'P AMRUTHA'],['23KD1A05I6', 'P SRIVALLI'],['23KD1A05I7', 'P JAHNAVI'],['23KD1A05I8', 'P SURENDRA REDDY'],
    ['23KD1A05I9', 'P SRAVYA'],['23KD1A05J0', 'P SAHITH'],['23KD1A05J1', 'P BHAVYA SRI'],['23KD1A05J2', 'P MEENAKSHI'],
    ['23KD1A05J3', 'P PRIYANKA'],['23KD1A05J4', 'P CHITTI BABU'],['23KD1A05J5', 'P MYTHRI'],['23KD1A05J6', 'JAHNAVI LATHA'],
    ['23KD1A05J8', 'P VARUDHINI'],['24KD5A0512', 'P REENUKA'],['24KD5A0513', 'P NAGESHWARI'],['24KD5A0514', 'P VINAY'],
    ['24KD5A0515', 'R PREMKUMAR'],['24KD5A0516', 'S SUJATHA'],['24KD5A0517', 'S KUMARRAJA']
  ],
  D: [
    ['23KD1A05J9', 'PORAPU PADMA'],['23KD1A05K0', 'POTHINA APPALA DURGA GUNA MANASA SREE'],['23KD1A05K1', 'POTIPARTHI CHARISHMA'],['23KD1A05K2', 'POTIPIREDDI VANDANA'],
    ['23KD1A05K3', 'POTNURU LEELA KUMARI'],['23KD1A05K4', 'PUDI SANJANA'],['23KD1A05K5', 'PURIJALA RAMACHANDRA RAO'],['23KD1A05K6', 'PUSAPATI SATWIK VARMA'],
    ['23KD1A05K7', 'PUVVALA SAI BHARADWAJ'],['23KD1A05K8', 'PYLA SRAVYA'],['23KD1A05K9', 'RAGHUMANDA SAITEJA'],['23KD1A05L0', 'RAGHUMANDA SRAVANTHI'],
    ['23KD1A05L1', 'RAI CHIRANJEEVI'],['23KD1A05L2', 'RAJANA LIKHITHA'],['23KD1A05L3', 'RAJANA NAVEEN'],['23KD1A05L4', 'RAPARTHI CHANDU'],
    ['23KD1A05L5', 'REGETI SOWJANYA'],['23KD1A05L6', 'RIKKA KALYANI'],['23KD1A05L7', 'SAMBANA HARSHIT'],['23KD1A05L8', 'SANAPATHI MANJULA'],
    ['23KD1A05L9', 'SARIKI HEMANTH'],['23KD1A05M0', 'SATHI CHANDRA SEKHAR MANIKANTA REDDY'],['23KD1A05M1', 'SATHI SASINDRA CHAITANYA REDDY'],['23KD1A05M2', 'SATYAVARAPU RADHA'],
    ['23KD1A05M3', 'SETTY MOUNIKA TEJASWINI'],['23KD1A05M4', 'SHAIK ABEED'],['23KD1A05M5', 'SHEIK UMAR RAFEE'],['23KD1A05M6', 'SIDDA HITANSHA'],
    ['23KD1A05M7', 'SIMHADRI YASASWI'],['23KD1A05M8', 'SINGARAPU DIVYA'],['23KD1A05M9', 'SINKA VENU SREE'],['23KD1A05N0', 'SIRUVURI RAMYA'],
    ['23KD1A05N1', 'SRIDHARALA JASWANTH'],['23KD1A05N2', 'SUNKARI INDHU'],['23KD1A05N3', 'SUNKARI MOUNIKA'],['23KD1A05N4', 'SUNKARI VENKATA APOORVA'],
    ['23KD1A05N5', 'TADANGI KARTHIK'],['23KD1A05N6', 'TALADA VINAY KUMAR'],['23KD1A05N7', 'TALLAPUDI SALMON RAJ'],['23KD1A05N8', 'TANAVARAPU HARSHA VARDHAN'],
    ['23KD1A05N9', 'TELUKALA VIJAYKUMAR SAHU'],['23KD1A05O0', 'THAPPITA CHANDRA SEKHAR'],['23KD1A05O1', 'THONANGI KIRAN REDDY'],['23KD1A05O2', 'TIRUVEEDHULA KARTHIK'],
    ['23KD1A05O3', 'TOMPALA KARTHIK'],['23KD1A05O4', 'TULA SAI NAGA VENKATA SIRI'],['23KD1A05O5', 'UMMIREDDY GAYATRI'],['23KD1A05O6', 'UPPILI HARSHAVARDHAN'],
    ['23KD1A05O7', 'UTTARAVELLI NAVEEN KUMAR'],['23KD1A05O8', 'UYAKA SAILAJA'],['23KD1A05O9', 'VARANASI KEERTHANA'],['23KD1A05P0', 'VEJENDLA CHATURYA PHANI'],
    ['23KD1A05P1', 'VELUVALI  NAVYA SREE'],['23KD1A05P2', 'VEMPADAPU SUCHITRA'],['23KD1A05P3', 'VEMPALI SAMPATH KUMAR'],['23KD1A05P4', 'VENDRAPU RAMYA SREE'],
    ['23KD1A05P5', 'VIJINIGIRI LATHA'],['23KD1A05P6', 'VUDA GEETHA MADHURI'],['23KD1A05P7', 'YANDRAPU RAJESWARI'],['23KD1A05P8', 'YARABALA USHA SREE'],
    ['23KD1A05P9', 'YAVARNA SIREESHA'],['23KD1A05Q0', 'YEJJALA SIRI'],['23KD1A05Q1', 'YENDUVA VIKRAMADITYA NAIDU'],['23KD1A05Q2', 'YERRAMSETTI GOVARDHINI'],
    ['23KD1A05Q3', 'YERUBOTHU THANEESH KARTHEEK'],['24KD5A0518', 'SURAVARAPU DURGAPRASAD'],['24KD5A0519', 'TEEDA SIRISHA'],['24KD5A0520', 'TEJA SREE PENTYALA'],
    ['24KD5A0521', 'TETAKALI LAVANYA'],['24KD5A0522', 'VADAVALASA INDRASENA'],['24KD5A0523', 'YENUGULA ANITHA'],['24KD5A0524', 'YERLAJELLA KARTHIK'],
    ['24KD5A0525', 'REDDI SANDHYA']
  ]
};

let attendance = {};
let currentSection = 'A';

function showView(viewId) {
  ['adminLogin', 'attendance', 'studentLogin'].forEach(id => {
    document.getElementById(id).classList.add('hidden');
  });
  document.getElementById(viewId).classList.remove('hidden');
  
  ['AdminLogin', 'StudentLogin'].forEach(btn => {
    let navBtn = document.getElementById('nav' + btn);
    if(navBtn) navBtn.classList.remove('active');
  });
  
  if(viewId === 'adminLogin') document.getElementById('navAdminLogin').classList.add('active');
  else if(viewId === 'studentLogin') document.getElementById('navStudentLogin').classList.add('active');
}

function login() {
  let u = document.getElementById('username').value.trim();
  let p = document.getElementById('password').value.trim();
  
  fetch('/api/login', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({username:u, password:p})
  }).then(resp => resp.json()).then(data => {
    if(data.success){
      showView('attendance');
      let today = new Date().toISOString().split('T')[0];
      document.getElementById('dateInput').value = today;
      document.getElementById('checkDateInput').value = today;
      showSection('A');
    } else {
      document.getElementById('logmsg').innerHTML = '<div class="error">‚ùå ' + (data.error || 'Login failed') + '</div>';
    }
  }).catch(e => {
    document.getElementById('logmsg').innerHTML = '<div class="error">‚ùå Error: ' + e.message + '</div>';
  });
}

function logoutAdmin() {
  attendance = {};
  document.getElementById('username').value = '';
  document.getElementById('password').value = '';
  document.getElementById('logmsg').innerHTML = '';
  document.getElementById('savemsg').innerHTML = '';
  showView('adminLogin');
}

function forgotpw() {
  let u = document.getElementById('username').value.trim() || '';
  fetch('/api/forgot_password', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({username:u})
  }).then(resp => resp.json()).then(data => {
    if(data.success){
      document.getElementById('logmsg').innerHTML = '<div class="success">‚úì Password sent to your email!</div>';
    } else {
      document.getElementById('logmsg').innerHTML = '<div class="error">‚ùå ' + (data.error || 'Failed') + '</div>';
    }
  });
}

function showSection(sec) {
  currentSection = sec;
  ['A','B','C','D'].forEach(s => {
    document.getElementById('secBtn'+s).classList.remove('active');
  });
  document.getElementById('secBtn'+sec).classList.add('active');
  let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
  renderTable(date);
}

function renderTable(date) {
  let tbody = document.getElementById('attBody');
  tbody.innerHTML = '';
  
  sectionStudents[currentSection].forEach(([reg, name]) => {
    let stat = (attendance[date] && attendance[date][reg]) || 'Present';
    
    let tr = document.createElement('tr');
    tr.innerHTML = `
      <td><strong>${reg}</strong></td>
      <td>${name}</td>
      <td>
        <div class="attendance-btn-group">
          <button class="present-btn${stat === 'Present' ? ' active' : ''}" onclick="setStatus('${reg}', 'Present', this)">Present</button>
          <button class="absent-btn${stat === 'Absent' ? ' active' : ''}" onclick="setStatus('${reg}', 'Absent', this)">Absent</button>
          <button class="permission-btn${stat === 'Permission' ? ' active' : ''}" onclick="setStatus('${reg}', 'Permission', this)">Permission</button>
        </div>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function setStatus(reg, status, btn) {
  let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
  if (!attendance[date]) attendance[date] = {};
  attendance[date][reg] = status;
  
  let td = btn.parentNode;
  [...td.querySelectorAll('button')].forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

document.getElementById('dateInput').addEventListener('change', function() {
  renderTable(this.value);
});

function saveAllAttendance() {
  let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
  let allAttendance = {};
  
  ['A','B','C','D'].forEach(sec => {
    sectionStudents[sec].forEach(([reg, name]) => {
      let status = (attendance[date] && attendance[date][reg]) || 'Present';
      allAttendance[reg] = {name: name, status: status, section: sec};
    });
  });
  
  fetch('/api/save', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({date: date, attendance: allAttendance})
  }).then(resp => resp.json()).then(data => {
    if(data.success){
      document.getElementById('savemsg').innerHTML = '<div class="success">‚úì Attendance saved for ' + date + '</div>';
      setTimeout(() => { document.getElementById('savemsg').innerHTML = ''; }, 3000);
    }
  });
}

function downloadAbsentees() {
  let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
  window.location.href = '/api/export_absentees/?date=' + date;
}

function downloadWeekly() {
  let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
  window.location.href = '/api/export_weekly_report/?start_date=' + date;
}

function checkStatus() {
  let reg = document.getElementById('checkRegInput').value.trim().toUpperCase();
  let date = document.getElementById('checkDateInput').value;
  
  if(!reg || !date){
    document.getElementById('checkResult').innerHTML = '<span class="error">‚ùå Enter reg. number and date</span>';
    return;
  }
  
  fetch(`/api/check?regno=${reg}&date=${date}`)
    .then(resp => resp.json())
    .then(data => {
      document.getElementById('checkResult').innerHTML = `<span class="success">‚úì ${reg} was ${data.status} on ${date}</span>`;
    });
}

function checkStudentAttendance() {
  let regno = document.getElementById('stuUsername').value.trim().toUpperCase();
  let date = document.getElementById('stuDate').value;
  
  if(!regno){
    document.getElementById('stuLoginMsg').innerHTML = '<div class="error">‚ùå Enter your registration number</div>';
    return;
  }
  if(!date){
    document.getElementById('stuAttendanceResult').innerHTML = '<div class="error">‚ùå Select a date</div>';
    return;
  }
  
  fetch('/api/student_login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({username: regno})
  }).then(resp => resp.json()).then(data => {
    if(data.success){
      fetch(`/api/student/check_attendance?regno=${regno}&date=${date}`)
        .then(resp => resp.json())
        .then(data => {
          let color = data.status === 'Present' ? '#4caf50' : data.status === 'Absent' ? '#f44336' : '#ff9800';
          document.getElementById('stuAttendanceResult').innerHTML = 
            `<div style="padding: 15px; border-radius: 8px; background: ${color}20; border-left: 4px solid ${color}; color: ${color}; font-weight: bold;">
              ‚úì Your attendance on ${date} is: <strong>${data.status}</strong>
            </div>`;
          document.getElementById('stuLoginMsg').innerHTML = '';
        });
    } else {
      document.getElementById('stuLoginMsg').innerHTML = '<div class="error">‚ùå ' + (data.error || 'Invalid registration') + '</div>';
      document.getElementById('stuAttendanceResult').innerHTML = '';
    }
  });
}

function logoutStudent() {
  document.getElementById('stuUsername').value = '';
  document.getElementById('stuDate').value = '';
  document.getElementById('stuLoginMsg').innerHTML = '';
  document.getElementById('stuAttendanceResult').innerHTML = '';
  showView('adminLogin');
}

window.addEventListener('load', function() {
  showView('adminLogin');
});
</script>

</body>
</html>

