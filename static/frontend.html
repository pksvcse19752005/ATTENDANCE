<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Attendance Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin:0; background:#f0f4fa;}
    header {
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,.06);
      padding: 0 0;
    }
    .apptitle {
      display: flex; align-items: center; padding: 9px 24px 0 24px;
    }
    .apptitle svg { height: 38px; margin-right: 17px;}
    .apptitle h1 {
      font-family: 'Baloo', cursive; font-size: 2.4rem; margin:0; color: #16883d;
      letter-spacing: 2px; font-weight: 700; display: inline;
    }
    .apptitle span {
      font-size:2.2rem; color: #ffb300; font-weight:600; letter-spacing:2px;
    }
    nav {
      display: flex; background: #16883d; color:#fff; font-size: 1.07rem;
      padding: 0 24px; margin-bottom:8px; border-top:2px solid #ededed;
    }
    nav button {
      background: none; border: none; color: #fff; font-weight: 600;
      padding: 12px 22px; margin-right: 6px; cursor: pointer;
      transition: background .19s;
    }
    nav button:hover, nav button.active {
      background: #09522b; border-radius: 8px 8px 0 0;
    }
    .main-content { max-width:1020px; margin:25px auto; display:grid; grid-template-columns:1fr 1fr; gap:28px;}
    @media (max-width:850px) {
      .main-content { grid-template-columns:1fr; }
    }
    .login-card, .attendance-card {
      background: #fff; box-shadow:0 3px 18px rgba(0,0,0,.07);
      border-radius:14px; padding:32px 32px 19px 32px; margin-bottom:12px;
      min-width:280px; max-width:440px; margin:auto;
    }
    .login-card h2 { font-size:1.5rem; margin-bottom:4px; color:#16883d;}
    .attendance-card h2 { font-size:1.3rem; margin-bottom:3px;}
    .avatar { text-align:center; margin-bottom:8px;}
    .avatar svg {height:56px;}
    label { display: block; color:#374551; font-weight:500; margin-top:17px;}
    input[type="text"], input[type="password"], input[type="date"] {
      margin-top:8px; padding:8px; width:100%; border-radius:6px; border:1px solid #b7d2ca;
      font-size:1.07rem;
      margin-bottom:9px;
      background:#f6fcfa;
    }
    button, .btn {
      background: #16883d; color: #fff; border: none; padding: 10px 19px; border-radius: 7px; font-size: 1.07rem; font-weight: bold; cursor: pointer; margin-top: 11px; margin-bottom:8px;
      transition: background .17s;
    }
    button:hover, .btn:hover {
      background: #09522b;
    }
    .error { color: #f44336; font-size:0.98rem; margin:8px 0;}
    .success { color: #16c79a; font-size:0.98rem;}
    .attendance-table, .attendance-table th, .attendance-table td { border: 1px solid #ebebeb; border-collapse: collapse;}
    .attendance-table { width: 100%; margin-top:16px; }
    .attendance-table th { background: #ffe59b; font-size:1rem;} 
    .attendance-table td, .attendance-table th { padding: 8px 10px; text-align: left;}
    .section-buttons { margin-bottom:12px;}
    .section-buttons button {
      padding:7px 15px; margin-right:8px; border-radius:8px; border:none; cursor:pointer; background:#fbf7e2;
      color:#16883d; font-weight:600; font-size:1.05rem;
      box-shadow: 0 1px 5px rgba(0,0,0,.04);
      transition:.18s;
    }
    .section-buttons button.active, .section-buttons button:active { background:#ffd600; color:#09522b; }
    .actions-row { text-align:left; margin:14px 0;}
    .actions-row .btn { margin-right:10px;}
    .attendance-btn-group button {
      margin:0 3px; font-size:0.92rem; font-weight:600;
      border-radius:5px; box-shadow:0 2px 8px rgba(0,0,0,.02);
    }
    .present-btn { background:#90ee90; color:#146217; }
    .absent-btn { background:#f7b7b7; color:#bd2525;}
    .permission-btn { background:#ffe57f; color:#63560b;}
    .active { border: 2px solid #16883d; box-shadow: 0 0 8px #ddd;}
    .hidden { display:none !important; }
    .desc-text { color:#444; font-size:1rem; margin:13px 0;}
    .avatar svg { vertical-align:middle;}
    @media (max-width:530px) { .login-card, .attendance-card { padding:13px;  } }
  </style>
</head>
<body>
<header>
  <div class="apptitle">
    <svg viewBox="0 0 58 58" fill="none"><circle cx="29" cy="29" r="29" fill="#16883d"/><rect x="19" y="34" width="20" height="8" rx="4" fill="#ffd600"/><rect x="15" y="14" width="28" height="16" rx="5.5" fill="#fff"/><rect x="21" y="20" width="16" height="3" rx="1.5" fill="#16883d"/><rect x="21" y="25" width="10" height="2" rx="1" fill="#16883d"/></svg>
    <h1><span>A</span>ttendance <span>P</span>ortal</h1>
  </div>
  <nav>
    <button id="navAdmin" onclick="showView('adminLogin')" class="active">Admin Panel</button>
    <button id="navStudent" onclick="showView('studentLogin')">Student Attendance</button>
  </nav>
</header>

<div class="main-content">

  <!-- Admin Login Card -->
  <div id="adminLogin" class="login-card">
    <div class="avatar"><svg fill="#16883d" viewBox="0 0 40 40"><circle cx="20" cy="12" r="8"/><ellipse cx="20" cy="30" rx="12" ry="7"/></svg></div>
    <h2>Admin Login</h2>
    <p class="desc-text">Only admin users can mark daily attendance and export weekly or absentee reports.</p>
    <div id="logmsg"></div>
    <label for="username">Username</label>
    <input type="text" id="username" autocomplete="username" />
    <label for="password">Password</label>
    <input type="password" id="password" autocomplete="current-password" />
    <button onclick="login()">Login</button>
    <div style="margin:8px 0;">
      <a href="#" onclick="forgotpw();return false;" style="color:#16883d;font-weight:600;text-decoration:underline;font-size:.98rem;">Forgot Password?</a>
    </div>
  </div>

  <!-- Attendance Management Card (Admin) -->
  <div id="attendance" class="attendance-card hidden">
    <h2>Attendance Management Chart</h2>
    <div class="desc-text">Mark attendance (Present/Absent/Permission) and export reports for any date or section.</div>
    <div id="savemsg"></div>
    <label for="dateInput">Date</label>
    <input type="date" id="dateInput" />

    <div class="actions-row">
      <button id="saveAllBtn" class="btn">Save All Sections</button>
      <button id="downloadBtn" class="btn">Download Absentees & Permissions</button>
      <button id="downloadWeeklyBtn" class="btn">Download Weekly Report</button>
    </div>
    <div style="margin-bottom:17px;">
      <label><b>Check Any Student's Attendance</b></label>
      <input type="text" id="checkRegInput" placeholder="Reg. Number (23KD1A05D3)" style="width:145px; display:inline-block;" />
      <input type="date" id="checkDateInput" style="width:130px; display:inline-block;" />
      <button onclick="checkStatus()" class="btn" style="background:#09522b;">Check</button>
      <span id="checkResult"></span>
    </div>
    <div class="section-buttons">
      <button onclick="showSection('A')" id="secBtnA" class="active">Section A</button>
      <button onclick="showSection('B')" id="secBtnB">Section B</button>
      <button onclick="showSection('C')" id="secBtnC">Section C</button>
      <button onclick="showSection('D')" id="secBtnD">Section D</button>
    </div>
    <table class="attendance-table">
      <thead>
        <tr>
          <th>Reg Number</th>
          <th>Name</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="attBody"></tbody>
    </table>
    <button onclick="logoutAdmin()" class="btn" style="margin-top:12px;background:#f44336;">Logout</button>
  </div>

  <!-- Student Attendance Card -->
  <div id="studentLogin" class="login-card hidden">
    <div class="avatar"><svg fill="#16883d" viewBox="0 0 40 40"><circle cx="20" cy="12" r="8"/><ellipse cx="20" cy="30" rx="12" ry="7"/><rect x="12" y="8" width="16" height="2" rx="1" fill="#ffd600"/></svg></div>
    <h2>Student Attendance Check</h2>
    <div class="desc-text">Type your registration number and date to view your attendance status.</div>
    <div id="stuLoginMsg" class="error"></div>
    <label for="stuUsername">Registration Number</label>
    <input type="text" id="stuUsername" placeholder="e.g. 23KD1A05H2" />
    <label for="stuDate">Date</label>
    <input type="date" id="stuDate" />
    <button onclick="checkStudentAttendance()">Check Attendance</button>
    <div id="stuAttendanceResult" style="margin-top:15px; font-weight:bold;"></div>
    <button onclick="logoutStudent()" class="btn" style="margin-top:14px;background:#f44336;">Logout</button>
  </div>

</div>
<!-- END main-content -->

<script>
// [Shortened student list for brevity; add full list in your code]
const sectionStudents = {
  A: [
    ['23KD1A0501', 'ABDUL GUFFRAN'],['23KD1A0502', 'ADAPAKA TEJASRI'],['23KD1A0503', 'ADDANKI MAHESWARI'],['23KD1A0504', 'ALAMANDA SANJANA BLESSY'],
    ['23KD1A0505', 'ALAVELLI SRIPRIYA'],['23KD1A0506', 'AAMUDALA RAJESH'],['23KD1A0507', 'APPANA PRANEETH KUMAR'],['23KD1A0508', 'BADIGANTI MANOJ'],
    ['23KD1A0509', 'BAGGAM BHAVANASRI'],['23KD1A0510', 'BALIVADA MRUDULA'],['23KD1A0511', 'BANGARU VANDHANA'],['23KD1A0512', 'BANKI SAI MONISH'],
    ['23KD1A0513', 'BATTULA SAI KUMAR'],['23KD1A0514', 'BAYYA AKHIL'],['23KD1A0515', 'BEVARA DEVI PRASAD'],['23KD1A0516', 'BHASKARA AKSHAYA KUNDANIKA'],
    ['23KD1A0517', 'BHOGAPURAPU SAI MEGHANA'],['23KD1A0518', 'BITRA GIRIDDHAR'],['23KD1A0519', 'BODASINGI SIRISHA'],['23KD1A0520', 'BODDETI VYSHNAVI'],
    ['23KD1A0521', 'BODDU APPALA RAJU'],['23KD1A0522', 'BOGADI NAGAMANI'],['23KD1A0523', 'BONTHU SRUTHI'],['23KD1A0524', 'BURADA MEGHANA'],
    ['23KD1A0525', 'CHALICHAMA LOKESH SEETHARAM'],['23KD1A0526', 'CHANDAKA BHARATH KUMAR'],['23KD1A0527', 'CHANDAKA PAVITHRA'],['23KD1A0528', 'CHAPPA BHUVANA SAI'],
    ['23KD1A0529', 'CHILAKALAPUDI SRIVALLI'],['23KD1A0530', 'CHINTALAPATI LAKSHMI'],['23KD1A0531', 'CHITROTHU RAHUL KRISHNA'],['23KD1A0532', 'CHOKKAPU MOHAN SATHVIK'],
    ['23KD1A0533', 'CHUKKA JNANACHARAN'],['23KD1A0534', 'CHUKKA SAI KIRAN'],['23KD1A0535', 'DACHEPALLI MADHUMITHA'],['23KD1A0537', 'DANDU UDAY KIRAN'],
    ['23KD1A0538', 'DASARI LOVA RAJU'],['23KD1A0539', 'DASARI MOHAN'],['23KD1A0540', 'DASARI SURESH'],['23KD1A0541', 'DATLA SEETHARAMARAJU'],
    ['23KD1A0542', 'DATTI ANU'],['23KD1A0543', 'DEEPATI MOHITH'],['23KD1A0544', 'DEVU VENKATAVIVEK'],['23KD1A0545', 'DOKARA SURESH'],
    ['23KD1A0546', 'DORA KARTHIK'],['23KD1A0547', 'DUMPALA SANYASIRAO'],['23KD1A0548', 'DUVVU TEJESWAR'],['23KD1A0549', 'ELURU BHANUSHANKAR'],
    ['23KD1A0550', 'ESSARAPU AVINASH'],['23KD1A0551', 'ETTLA MARY AKSHITHA'],['23KD1A0552', 'FARHEEN MUNAVVAR FATHIMA'],['23KD1A0553', 'GADABANTI GANESH'],
    ['23KD1A0554', 'GANDATE ROHIT KUMAR'],['23KD1A0555', 'GANDHULI MONIKA'],['23KD1A0556', 'GANDRETI GEETHA SRI'],['23KD1A0557', 'GANDUBARIKI PRAGNA'],
    ['23KD1A0558', 'GARE TEJASWINI'],['23KD1A0559', 'GARI VENKATAMANIKANTA'],['23KD1A0560', 'GEDALA CHARMILA DEVI SRI'],['23KD1A0561', 'GEDALA DIVYA'],
    ['23KD1A0562', 'GEDELA SATEESH'],['23KD1A0563', 'GOLLU ADITYA'],['23KD1A0564', 'GOLLU PAVAN KUMAR'],['23KD1A0565', 'GORLE HARITHA'],
    ['23KD1A0566', 'GOTTAPU LAKSHMI CHARAN'],['22KD1A0575', 'KANDUKURI ABHILASH'],['24KD5A0501', 'BANDARU SREERAM'],['24KD5A0502', 'BAVISETTI MANOJ KUMAR'],
    ['24KD5A0503', 'BENDI BHAVANI'],['24KD5A0504', 'BONDA SURESH'],['24KD5A0505', 'GOLAJANI JHANSI'],['20KD1A05G5', 'SIMMITI KARUNA BABU']
  ],
  B: [
    ['23KD1A0567', 'GRANDHI MANASA'],['23KD1A0568', 'GUDDALA JAHNAVI'],['23KD1A0569', 'GUDEPU YASWANTH'],['23KD1A0570', 'GUDLA BHARATHI RATHNA KUMARI'],
    ['23KD1A0571', 'GULAMAJJI BHARGAV'],['23KD1A0572', 'GUNANA SAILAJA'],['23KD1A0573', 'GUNDU PRIYANKA'],['23KD1A0574', 'GUNTUKU ABHISHEK SAI'],
    ['23KD1A0575', 'GURRALA NAGA VARSHITHA'],['23KD1A0576', 'GURUGU VINAY KUMAR'],['23KD1A0577', 'HARIDASULA HARSHA VARDHAN'],['23KD1A0578', 'IMANDI HARISH'],
    ['23KD1A0579', 'IMANDI MYTHRI'],['23KD1A0580', 'IMMIDISETTI SNEHITHA'],['23KD1A0581', 'JAMI INDUMATHI'],['23KD1A0582', 'JAMPA HARSHITHA'],
    ['23KD1A0583', 'JAMPARANGI DINESH KUMAR'],['23KD1A0584', 'JARAJAPU DURGA PRASAD'],['23KD1A0585', 'JARJAPU PRASANTH'],['23KD1A0586', 'JUTTADA SWETHA'],
    ['23KD1A0587', 'JYOTHSNA ARDHAHAKULA'],['23KD1A0588', 'KAKARLAPUDI NARASIMHA ANIRUDH VARMA'],['23KD1A0589', 'KALISETTI DEEPAK'],['23KD1A0590', 'KALISETTI HARINI'],
    ['23KD1A0591', 'KALIVARAPU NAMRATHA'],['23KD1A0592', 'KALLA VENKATA HIRAN MAAVI'],['23KD1A0593', 'KALYAMPUDI RAVI KIRAN'],['23KD1A0594', 'KALYANAM GOWTHAMI'],
    ['23KD1A0596', 'KANCHUPARTHI JYOTHSNA'],['23KD1A0597', 'KANDI ASHISH'],['23KD1A0598', 'KANURI PUJITHA'],['23KD1A0599', 'KARRI DIVYA RANI'],
    ['23KD1A05A0', 'KARRI RAKSHITHA'],['23KD1A05A1', 'KARRI SATYA GOWTHAM KUMAR REDDY'],['23KD1A05A2', 'KASIREDDY JYOTHI SHIVANANDH'],['23KD1A05A3', 'KATTAMURI PRAVALLIKA'],
    ['23KD1A05A4', 'KATTOJU ABILESH'],['23KD1A05A5', 'KELLA MITHIN KUMAR'],['23KD1A05A6', 'KILLO CHINNI PRAKASH'],['23KD1A05A8', 'KOLA ABHISHEK'],
    ['23KD1A05A9', 'KOLA VARSHINI'],['23KD1A05B0', 'KOLAGANA POORNA CHANDRA RAO'],['23KD1A05B1', 'KOLLA SRAVANI'],['23KD1A05B2', 'KOLUSU ABHINAYA ANJALI'],
    ['23KD1A05B3', 'KONADA RASHMITHA'],['23KD1A05B4', 'KONDAKA SOWMYA'],['23KD1A05B5', 'KONDAPU RAMI REDDY'],['23KD1A05B6', 'KORADA JAGADEESH'],
    ['23KD1A05B7', 'KORADA NAGA DEVI'],['23KD1A05B8', 'KOSARA AKASH'],['23KD1A05B9', 'KOSIREDDY SAI KUMAR'],['23KD1A05C0', 'KOTTAKOTA KAVERI'],
    ['23KD1A05C1', 'KOTYADA BHARGAVI'],['23KD1A05C2', 'KOTYADA MAHESH'],['23KD1A05C3', 'KOVVURI CHARAN KUMAR REDDY'],['23KD1A05C5', 'KOVVURU KIRANSAI'],
    ['23KD1A05C6', 'KURIMINELLI POOJITHA'],['23KD1A05C7', 'LENKA BHARGAVI'],['23KD1A05C8', 'LODAGALA THARUN'],['23KD1A05C9', 'MADHABATHULA MANOJ KUMAR'],
    ['23KD1A05D0', 'MAJJI BHANUSRI'],['23KD1A05D1', 'MAMIDI MARUTHI PRASAD'],['23KD1A05D2', 'NAGIREDLA SRAVANI'],['24KD5A0506', 'GOLLU DURGAPRASAD'],
    ['24KD5A0507', 'GUNDU BALU'],['24KD5A0508', 'JAJIMOGGALA SRAVANTHI'],['24KD5A0509', 'KOTNANA LAHARI'],['24KD5A0510', 'MADDI KUMAR'],
    ['24KD5A0511', 'MANDALA MAHESH NAIDU']
  ],
  C: [
    ['23KD1A05D3', 'M BHARGAVI'],['23KD1A05D4', 'M PRAVALLIKA'],['23KD1A05D5', 'M VARAPRASAD'],['23KD1A05D6', 'M MEGHANA'],
    ['23KD1A05D7', 'M SWETHA'],['23KD1A05D8', 'M ABHINAV'],['23KD1A05D9', 'M NAVYATHA'],['23KD1A05E0', 'M SINDHUJA'],
    ['23KD1A05E1', 'M PRANATHI'],['23KD1A05E2', 'M HARSHITHA'],['23KD1A05E3', 'M SHARMILA'],['23KD1A05E4', 'M SHAILAJA'],
    ['23KD1A05E5', 'MOHSIN ALI'],['23KD1A05E6', 'M FARHEEN BEGUM'],['23KD1A05E7', 'M VAMSI KRISHNA'],['23KD1A05E8', 'M MADHURI'],
    ['23KD1A05E9', 'M SARAYU SRI'],['23KD1A05F0', 'M YUVA KIRAN'],['23KD1A05F1', 'M JYOTHSNA'],['23KD1A05F2', 'M BENSON'],
    ['23KD1A05F3', 'M BHARAT'],['23KD1A05F4', 'M MANOJ KUMAR'],['23KD1A05F5', 'N DEVI'],['23KD1A05F6', 'N ADHARSH'],
    ['23KD1A05F7', 'N SUBHASH'],['23KD1A05F9', 'N PRAVEEN KUMAR'],['23KD1A05G0', 'N KYATHI'],['23KD1A05G1', 'N PRANATHI'],
    ['23KD1A05G2', 'N HARI CHARAN'],['23KD1A05G3', 'NANADHINI M'],['23KD1A05G4', 'N CHANIKYA'],['23KD1A05G5', 'N MEGHANA'],
    ['23KD1A05G6', 'N SAITEJA'],['23KD1A05G7', 'N DRAKSHAMANI'],['23KD1A05G8', 'N LAVANYA'],['23KD1A05G9', 'N AISHWARYA'],
    ['23KD1A05H0', 'N GEETHA'],['23KD1A05H1', 'P CHIDVILAS'],['23KD1A05H2', 'P KIRAN'],['23KD1A05H3', 'P HARISHANKAR'],
    ['23KD1A05H4', 'P SAIKIRAN'],['23KD1A05H5', 'PVS POORNANANDA'],['23KD1A05H7', 'P GEETHASRI'],['23KD1A05H8', 'P KAVITHA'],
    ['23KD1A05I0', 'P VINEELA'],['23KD1A05I1', 'P SUMANTH'],['23KD1A05I2', 'P GEETHANJALI'],['23KD1A05I3', 'P DEEPIKA'],
    ['23KD1A05I4', 'P AMRUTHA'],['23KD1A05I6', 'P SRIVALLI'],['23KD1A05I7', 'P JAHNAVI'],['23KD1A05I8', 'P SURENDRA REDDY'],
    ['23KD1A05I9', 'P SRAVYA'],['23KD1A05J0', 'P SAHITH'],['23KD1A05J1', 'P BHAVYA SRI'],['23KD1A05J2', 'P MEENAKSHI'],
    ['23KD1A05J3', 'P PRIYANKA'],['23KD1A05J4', 'P CHITTI BABU'],['23KD1A05J5', 'P MYTHRI'],['23KD1A05J6', 'JAHNAVI LATHA'],
    ['23KD1A05J8', 'P VARUDHINI'],['24KD5A0512', 'P REENUKA'],['24KD5A0513', 'P NAGESHWARI'],['24KD5A0514', 'P VINAY'],
    ['24KD5A0515', 'R PREMKUMAR'],['24KD5A0516', 'S SUJATHA'],['24KD5A0517', 'S KUMARRAJA']
  ],
  D: [
    ['23KD1A05J9', 'PORAPU PADMA'],['23KD1A05K0', 'POTHINA APPALA DURGA GUNA MANASA SREE'],['23KD1A05K1', 'POTIPARTHI CHARISHMA'],['23KD1A05K2', 'POTIPIREDDI VANDANA'],
    ['23KD1A05K3', 'POTNURU LEELA KUMARI'],['23KD1A05K4', 'PUDI SANJANA'],['23KD1A05K5', 'PURIJALA RAMACHANDRA RAO'],['23KD1A05K6', 'PUSAPATI SATWIK VARMA'],
    ['23KD1A05K7', 'PUVVALA SAI BHARADWAJ'],['23KD1A05K8', 'PYLA SRAVYA'],['23KD1A05K9', 'RAGHUMANDA SAITEJA'],['23KD1A05L0', 'RAGHUMANDA SRAVANTHI'],
    ['23KD1A05L1', 'RAI CHIRANJEEVI'],['23KD1A05L2', 'RAJANA LIKHITHA'],['23KD1A05L3', 'RAJANA NAVEEN'],['23KD1A05L4', 'RAPARTHI CHANDU'],
    ['23KD1A05L5', 'REGETI SOWJANYA'],['23KD1A05L6', 'RIKKA KALYANI'],['23KD1A05L7', 'SAMBANA HARSHIT'],['23KD1A05L8', 'SANAPATHI MANJULA'],
    ['23KD1A05L9', 'SARIKI HEMANTH'],['23KD1A05M0', 'SATHI CHANDRA SEKHAR MANIKANTA REDDY'],['23KD1A05M1', 'SATHI SASINDRA CHAITANYA REDDY'],['23KD1A05M2', 'SATYAVARAPU RADHA'],
    ['23KD1A05M3', 'SETTY MOUNIKA TEJASWINI'],['23KD1A05M4', 'SHAIK ABEED'],['23KD1A05M5', 'SHEIK UMAR RAFEE'],['23KD1A05M6', 'SIDDA HITANSHA'],
    ['23KD1A05M7', 'SIMHADRI YASASWI'],['23KD1A05M8', 'SINGARAPU DIVYA'],['23KD1A05M9', 'SINKA VENU SREE'],['23KD1A05N0', 'SIRUVURI RAMYA'],
    ['23KD1A05N1', 'SRIDHARALA JASWANTH'],['23KD1A05N2', 'SUNKARI INDHU'],['23KD1A05N3', 'SUNKARI MOUNIKA'],['23KD1A05N4', 'SUNKARI VENKATA APOORVA'],
    ['23KD1A05N5', 'TADANGI KARTHIK'],['23KD1A05N6', 'TALADA VINAY KUMAR'],['23KD1A05N7', 'TALLAPUDI SALMON RAJ'],['23KD1A05N8', 'TANAVARAPU HARSHA VARDHAN'],
    ['23KD1A05N9', 'TELUKALA VIJAYKUMAR SAHU'],['23KD1A05O0', 'THAPPITA CHANDRA SEKHAR'],['23KD1A05O1', 'THONANGI KIRAN REDDY'],['23KD1A05O2', 'TIRUVEEDHULA KARTHIK'],
    ['23KD1A05O3', 'TOMPALA KARTHIK'],['23KD1A05O4', 'TULA SAI NAGA VENKATA SIRI'],['23KD1A05O5', 'UMMIREDDY GAYATRI'],['23KD1A05O6', 'UPPILI HARSHAVARDHAN'],
    ['23KD1A05O7', 'UTTARAVELLI NAVEEN KUMAR'],['23KD1A05O8', 'UYAKA SAILAJA'],['23KD1A05O9', 'VARANASI KEERTHANA'],['23KD1A05P0', 'VEJENDLA CHATURYA PHANI'],
    ['23KD1A05P1', 'VELUVALI  NAVYA SREE'],['23KD1A05P2', 'VEMPADAPU SUCHITRA'],['23KD1A05P3', 'VEMPALI SAMPATH KUMAR'],['23KD1A05P4', 'VENDRAPU RAMYA SREE'],
    ['23KD1A05P5', 'VIJINIGIRI LATHA'],['23KD1A05P6', 'VUDA GEETHA MADHURI'],['23KD1A05P7', 'YANDRAPU RAJESWARI'],['23KD1A05P8', 'YARABALA USHA SREE'],
    ['23KD1A05P9', 'YAVARNA SIREESHA'],['23KD1A05Q0', 'YEJJALA SIRI'],['23KD1A05Q1', 'YENDUVA VIKRAMADITYA NAIDU'],['23KD1A05Q2', 'YERRAMSETTI GOVARDHINI'],
    ['23KD1A05Q3', 'YERUBOTHU THANEESH KARTHEEK'],['24KD5A0518', 'SURAVARAPU DURGAPRASAD'],['24KD5A0519', 'TEEDA SIRISHA'],['24KD5A0520', 'TEJA SREE PENTYALA'],
    ['24KD5A0521', 'TETAKALI LAVANYA'],['24KD5A0522', 'VADAVALASA INDRASENA'],['24KD5A0523', 'YENUGULA ANITHA'],['24KD5A0524', 'YERLAJELLA KARTHIK'],
    ['24KD5A0525', 'REDDI SANDHYA']
  ]
};
let attendance = {};
let currentSection = 'A';

// Nav & Cards
function showView(viewId) {
  for (let id of ['adminLogin','attendance','studentLogin']) {
    document.getElementById(id).classList.add('hidden');
    document.getElementById('nav' + id.charAt(0).toUpperCase() + id.slice(1)).classList.remove('active');
  }
  document.getElementById(viewId).classList.remove('hidden');
  document.getElementById('nav'+viewId.charAt(0).toUpperCase()+viewId.slice(1)).classList.add('active');
}

// Admin login
function login() {
  let u = document.getElementById('username').value.trim();
  let p = document.getElementById('password').value.trim();
  fetch('/api/login', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({username:u, password:p})
  }).then(resp => resp.json()).then(data => {
    if(data.success){
      showView('attendance');
      let today = new Date().toISOString().split('T')[0];
      document.getElementById('dateInput').value = today;
      document.getElementById('checkDateInput').value = today;
      showSection('A');
    } else {
      document.getElementById('logmsg').innerHTML = '<div class="error">' + data.error + '</div>';
    }
  });
}

function logoutAdmin() {
  attendance = {};
  document.getElementById('username').value = '';
  document.getElementById('password').value = '';
  document.getElementById('logmsg').innerHTML = '';
  showView('adminLogin');
}

function forgotpw() {
  let u = document.getElementById('username').value.trim() || '';
  fetch('/api/forgot_password', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({username:u})
  }).then(resp => resp.json()).then(data =>{
      if(data.success){
          document.getElementById('logmsg').innerHTML = '<div class="success">Reset link sent to admin email.</div>';
      } else {
          document.getElementById('logmsg').innerHTML = `<div class="error">${data.error}</div>`;
      }
  });
}

// Attendance (Admin)
function showSection(sec) {
    currentSection = sec;
    for(let s of ['A','B','C','D']) {
      document.getElementById('secBtn'+s).classList.remove('active');
    }
    document.getElementById('secBtn'+sec).classList.add('active');
    let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
    renderTable(date);
}

function renderTable(date) {
    let tbody = document.getElementById('attBody');
    tbody.innerHTML = '';
    sectionStudents[currentSection].forEach(([reg,name]) => {
        let stat = (attendance[date] && attendance[date][reg]) || "Present";
        let tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${reg}</td>
            <td>${name}</td>
            <td class="attendance-btn-group">
                <button class="status-btn present-btn${stat=='Present'?' active':''}" onclick="setStatus('${reg}','Present',this)">Present</button>
                <button class="status-btn absent-btn${stat=='Absent'?' active':''}" onclick="setStatus('${reg}','Absent',this)">Absent</button>
                <button class="status-btn permission-btn${stat=='Permission'?' active':''}" onclick="setStatus('${reg}','Permission',this)">Permission</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function setStatus(reg, status, btn) {
    let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
    if (!attendance[date]) attendance[date] = {};
    attendance[date][reg] = status;
    let td = btn.parentNode;
    [...td.children].forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

document.getElementById('dateInput').onchange = function() { renderTable(this.value); };

document.getElementById('saveAllBtn').onclick = function() {
    let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
    let allAttendance = {};
    ['A','B','C','D'].forEach(sec => {
        sectionStudents[sec].forEach(([reg, name]) => {
            let status = (attendance[date] && attendance[date][reg]) || "Present";
            allAttendance[reg] = {name: name, status: status, section: sec};
        });
    });
    fetch('/api/save', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({date: date, attendance: allAttendance})
    }).then(resp => resp.json()).then(data => {
        if(data.success){
            document.getElementById('savemsg').innerHTML = '<div class="success">Attendance saved for ' + date + '</div>';
            setTimeout(() => { document.getElementById('savemsg').innerHTML = ''; }, 3000);
        }
    });
};

document.getElementById('downloadBtn').onclick = function() {
    let date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
    fetch('/api/export_absentees/?date=' + date).then(resp => resp.blob()).then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `absentees_permissions_${date}.xlsx`;
        document.body.appendChild(a);
        a.click();
        a.remove();
    });
};

document.getElementById('downloadWeeklyBtn').onclick = function() {
    let startDate = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
    fetch(`/api/export_weekly_report/?start_date=${startDate}`).then(resp => resp.blob()).then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `weekly_attendance_${startDate}.xlsx`;
        document.body.appendChild(a);
        a.click();
        a.remove();
    });
};

function checkStatus() {
    let reg = document.getElementById('checkRegInput').value.trim().toUpperCase();
    let date = document.getElementById('checkDateInput').value;
    if(!reg || !date){
        document.getElementById('checkResult').innerHTML = '<span class="error">Enter reg. number and date</span>';
        return;
    }
    fetch(`/api/check?regno=${reg}&date=${date}`)
    .then(resp => resp.json())
    .then(data => {
        document.getElementById('checkResult').innerText = `${reg} was marked as '${data.status}' on ${date}`;
    });
}

// Student attendance check (no login, just input and get status)
function checkStudentAttendance() {
    let regno = document.getElementById('stuUsername').value.trim().toUpperCase();
    let date = document.getElementById('stuDate').value;
    if(!regno){
        document.getElementById('stuLoginMsg').innerText = 'Enter your registration number';
        return;
    }
    if(!date){
        document.getElementById('stuAttendanceResult').innerText = "Please select a date";
        return;
    }
    fetch('/api/student_login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({username: regno})
    }).then(resp => resp.json()).then(data => {
        if(data.success){
            fetch(`/api/student/check_attendance?regno=${regno}&date=${date}`)
            .then(resp => resp.json())
            .then(data => {
                document.getElementById('stuAttendanceResult').innerText = `Your attendance on ${date} is: ${data.status}`;
                document.getElementById('stuLoginMsg').innerText = '';
            });
        } else {
            document.getElementById('stuLoginMsg').innerText = data.error || "Invalid registration number";
            document.getElementById('stuAttendanceResult').innerText = '';
        }
    });
}

function logoutStudent() {
    document.getElementById('stuUsername').value = '';
    document.getElementById('stuDate').value = '';
    document.getElementById('stuLoginMsg').innerText = '';
    document.getElementById('stuAttendanceResult').innerText = '';
}

window.onload = function() {
    showView('adminLogin');
};
</script>
</body>
</html>
